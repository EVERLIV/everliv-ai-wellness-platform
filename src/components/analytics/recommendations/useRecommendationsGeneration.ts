
import { useState, useEffect } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { toast } from 'sonner';
import { AnalyticsRecommendation } from '@/types/analyticsRecommendations';
import { CachedAnalytics } from '@/types/analytics';

export const useRecommendationsGeneration = (analytics: CachedAnalytics, healthProfile?: any) => {
  const [recommendations, setRecommendations] = useState<AnalyticsRecommendation[]>([]);
  const [isGenerating, setIsGenerating] = useState(false);
  const [lastAttempt, setLastAttempt] = useState<Date | null>(null);

  const generateGoalsBasedRecommendations = (analytics: CachedAnalytics, userGoals?: string[]): AnalyticsRecommendation[] => {
    const score = analytics.healthScore || 65;
    const goals = userGoals || [];
    
    console.log('üéØ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –¥–ª—è —Ü–µ–ª–µ–π:', goals);
    
    const recommendations: AnalyticsRecommendation[] = [];

    // –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ü–µ–ª–∏
    if (goals.includes('cognitive')) {
      recommendations.push({
        id: 'cognitive-enhancement',
        title: '–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ–Ω–∞—É–∫–∏',
        description: '–ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–∞–º—è—Ç–∏, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –∏ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —è—Å–Ω–æ—Å—Ç–∏',
        category: 'biohacking',
        priority: 'high',
        evidenceLevel: 'meta-analysis',
        safetyWarnings: [
          '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –Ω–µ–≤—Ä–æ–ª–æ–≥–æ–º –ø—Ä–∏ –ø—Ä–∏–µ–º–µ –Ω–æ–æ—Ç—Ä–æ–ø–æ–≤',
          '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä–æ–≤',
          '–û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –∞–Ω—Ç–∏–¥–µ–ø—Ä–µ—Å—Å–∞–Ω—Ç–∞–º–∏'
        ],
        contraindications: [
          '–≠–ø–∏–ª–µ–ø—Å–∏—è –∏ —Å—É–¥–æ—Ä–æ–∂–Ω—ã–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞',
          '–ë–∏–ø–æ–ª—è—Ä–Ω–æ–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–æ',
          '–ü—Ä–∏–µ–º –∞–Ω—Ç–∏–∫–æ–∞–≥—É–ª—è–Ω—Ç–æ–≤'
        ],
        implementation: {
          steps: [
            '–û–º–µ–≥–∞-3 (DHA): 1000-2000–º–≥ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –¥–ª—è –Ω–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏',
            '–õ—å–≤–∏–Ω–∞—è –≥—Ä–∏–≤–∞ (Hericium): 500-1000–º–≥ –¥–ª—è –Ω–µ–π—Ä–æ–≥–µ–Ω–µ–∑–∞',
            '–ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –≥–æ–ª–æ–¥–∞–Ω–∏–µ 16:8 –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ BDNF',
            '–ú–µ–¥–∏—Ç–∞—Ü–∏—è –º–∞–π–Ω–¥—Ñ—É–ª–Ω–µ—Å—Å 20 –º–∏–Ω—É—Ç –¥–ª—è –Ω–µ–π—Ä–æ–ø–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏',
            '–•–æ–ª–æ–¥–Ω—ã–µ –¥—É—à–∏ 2-3 –º–∏–Ω—É—Ç—ã –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –Ω–æ—Ä–∞–¥—Ä–µ–Ω–∞–ª–∏–Ω–∞'
          ],
          duration: '8-12 –Ω–µ–¥–µ–ª—å –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π',
          frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ —É—Ç—Ä–æ–º, –∫—Ä–æ–º–µ –≤—ã—Ö–æ–¥–Ω—ã—Ö',
          dosage: 'DHA: 1000-2000–º–≥, –õ—å–≤–∏–Ω–∞—è –≥—Ä–∏–≤–∞: 500-1000–º–≥'
        },
        scientificBasis: '–ú–µ—Ç–∞-–∞–Ω–∞–ª–∏–∑ 2024–≥: DHA + –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –≥–æ–ª–æ–¥–∞–Ω–∏–µ –ø–æ–≤—ã—à–∞—é—Ç BDNF –Ω–∞ 200-300%',
        biohackingLevel: 'intermediate'
      });

      recommendations.push({
        id: 'cognitive-nutrition',
        title: '–ù–µ–π—Ä–æ-–ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∏–µ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –º–æ–∑–≥–∞ –∏ –ø–∞–º—è—Ç–∏',
        category: 'nutrition',
        priority: 'high',
        evidenceLevel: 'rct',
        safetyWarnings: ['–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å –¥–∏–µ—Ç–æ–ª–æ–≥–æ–º –ø—Ä–∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö'],
        contraindications: ['–ê–ª–ª–µ—Ä–≥–∏—è –Ω–∞ –æ—Ä–µ—Ö–∏ –∏ —Ä—ã–±—É'],
        implementation: {
          steps: [
            '–ñ–∏—Ä–Ω–∞—è —Ä—ã–±–∞ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é (–ª–æ—Å–æ—Å—å, —Å–∫—É–º–±—Ä–∏—è)',
            '–ì—Ä–µ—Ü–∫–∏–µ –æ—Ä–µ—Ö–∏ 30–≥ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –¥–ª—è –∞–ª—å—Ñ–∞-–ª–∏–Ω–æ–ª–µ–Ω–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç—ã',
            '–ß–µ—Ä–Ω–∏–∫–∞ –∏ –≥–æ–ª—É–±–∏–∫–∞ 150–≥ –¥–ª—è –∞–Ω—Ç–æ—Ü–∏–∞–Ω–æ–≤',
            '–ö—É—Ä–∫—É–º–∞ —Å —á–µ—Ä–Ω—ã–º –ø–µ—Ä—Ü–µ–º –¥–ª—è –∫—É—Ä–∫—É–º–∏–Ω–∞',
            '–ó–µ–ª–µ–Ω—ã–π —á–∞–π 3 —á–∞—à–∫–∏ –¥–ª—è L-—Ç–µ–∞–Ω–∏–Ω–∞'
          ],
          duration: '6-8 –Ω–µ–¥–µ–ª—å –¥–ª—è –∑–∞–º–µ—Ç–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞',
          frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
          dosage: '–≥—Ä–µ—Ü–∫–∏–µ –æ—Ä–µ—Ö–∏: 30–≥/–¥–µ–Ω—å'
        },
        scientificBasis: '–†–ö–ò 2024–≥: —Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∞—è –¥–∏–µ—Ç–∞ + —è–≥–æ–¥—ã —É–ª—É—á—à–∞—é—Ç –ø–∞–º—è—Ç—å –Ω–∞ 25%',
        biohackingLevel: 'beginner'
      });

      recommendations.push({
        id: 'cognitive-tests',
        title: '–ê–Ω–∞–ª–∏–∑—ã –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∑–≥–∞',
        category: 'supplements',
        priority: 'medium',
        evidenceLevel: 'expert-opinion',
        safetyWarnings: ['–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–æ–ª—å–∫–æ —Å –≤—Ä–∞—á–æ–º'],
        contraindications: ['–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'],
        implementation: {
          steps: [
            '–í–∏—Ç–∞–º–∏–Ω B12 –∏ —Ñ–æ–ª–∏–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ –¥–ª—è –Ω–µ–π—Ä–æ–ø—Ä–æ—Ç–µ–∫—Ü–∏–∏',
            '–ì–æ–º–æ—Ü–∏—Å—Ç–µ–∏–Ω - –º–∞—Ä–∫–µ—Ä —Å–æ—Å—É–¥–∏—Å—Ç–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –º–æ–∑–≥–∞',
            '–í–∏—Ç–∞–º–∏–Ω D –¥–ª—è –Ω–µ–π—Ä–æ–º–æ–¥—É–ª—è—Ü–∏–∏',
            '–û–º–µ–≥–∞-3 –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ—Ü–µ–Ω–∫–∏ DHA/EPA',
            '–ò–Ω—Å—É–ª–∏–Ω –Ω–∞—Ç–æ—â–∞–∫ –¥–ª—è –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–æ–≥–æ –∑–¥–æ—Ä–æ–≤—å—è –º–æ–∑–≥–∞'
          ],
          duration: '–∫–∞–∂–¥—ã–µ 6 –º–µ—Å—è—Ü–µ–≤',
          frequency: '—Ä–∞–∑ –≤ –ø–æ–ª–≥–æ–¥–∞',
          dosage: '–ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –≤—Ä–∞—á–∞'
        },
        scientificBasis: '–ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–µ–≤—Ä–æ–ª–æ–≥–æ–≤ 2024–≥',
        biohackingLevel: 'intermediate'
      });
    }

    // –°–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç—ã–µ —Ü–µ–ª–∏
    if (goals.includes('cardiovascular')) {
      recommendations.push({
        id: 'cardiovascular-optimization',
        title: '–ö–∞—Ä–¥–∏–æ–º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
        description: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–¥—Ü–∞ –∏ —Å–æ—Å—É–¥–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–π',
        category: 'exercise',
        priority: 'high',
        evidenceLevel: 'rct',
        safetyWarnings: [
          '–≠–ö–ì –∫–æ–Ω—Ç—Ä–æ–ª—å –ø—Ä–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞—Ö',
          '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∏–µ–º–µ –¥–æ–±–∞–≤–æ–∫',
          '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞ –ø—Ä–∏ –∞—Ä–∏—Ç–º–∏–∏'
        ],
        contraindications: [
          '–ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —Å—Ç–µ–Ω–æ–∫–∞—Ä–¥–∏—è',
          '–ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –≥–∏–ø–µ—Ä—Ç–æ–Ω–∏—è',
          '–ù–µ–¥–∞–≤–Ω–∏–π –∏–Ω—Ñ–∞—Ä–∫—Ç –º–∏–æ–∫–∞—Ä–¥–∞'
        ],
        implementation: {
          steps: [
            'HIIT —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –ø–æ 15-20 –º–∏–Ω—É—Ç',
            '–ö–æ—ç–Ω–∑–∏–º Q10: 100-200–º–≥ –¥–ª—è –º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–π —Å–µ—Ä–¥—Ü–∞',
            '–ú–∞–≥–Ω–∏–π –≥–ª–∏—Ü–∏–Ω–∞—Ç: 400–º–≥ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º –¥–ª—è —Ä–∏—Ç–º–∞',
            '–ó–æ–Ω–∞ 2 –∫–∞—Ä–¥–∏–æ 2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é –ø–æ 45 –º–∏–Ω—É—Ç',
            '–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ 4-7-8 –¥–ª—è –≤–∞—Ä–∏–∞–±–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∏—Ç–º–∞'
          ],
          duration: '6-8 –Ω–µ–¥–µ–ª—å –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π',
          frequency: '—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 5 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é',
          dosage: 'CoQ10: 100-200–º–≥, –ú–∞–≥–Ω–∏–π: 400–º–≥'
        },
        scientificBasis: '–†–ö–ò 2024–≥: HIIT + CoQ10 —É–ª—É—á—à–∞—é—Ç VO2max –Ω–∞ 15-25% –∑–∞ 8 –Ω–µ–¥–µ–ª—å',
        biohackingLevel: 'intermediate'
      });

      recommendations.push({
        id: 'cardiovascular-nutrition',
        title: '–ö–∞—Ä–¥–∏–æ–ø—Ä–æ—Ç–µ–∫—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ',
        description: '–ù–∞—É—á–Ω–æ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω–∞—è –¥–∏–µ—Ç–∞ –¥–ª—è –∑–∞—â–∏—Ç—ã —Å–µ—Ä–¥—Ü–∞ –∏ —Å–æ—Å—É–¥–æ–≤',
        category: 'nutrition',
        priority: 'high',
        evidenceLevel: 'meta-analysis',
        safetyWarnings: ['–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞–ª–∏—è –ø—Ä–∏ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö –ø–æ—á–µ–∫'],
        contraindications: ['–¢—è–∂–µ–ª–∞—è —Å–µ—Ä–¥–µ—á–Ω–∞—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç—å –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤—Ä–∞—á–∞'],
        implementation: {
          steps: [
            '–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ extra virgin 30–º–ª –µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
            '–ê–≤–æ–∫–∞–¥–æ –ø–æ–ª–æ–≤–∏–Ω–∞ –ø–ª–æ–¥–∞ –¥–ª—è –º–æ–Ω–æ–Ω–µ–Ω–∞—Å—ã—â–µ–Ω–Ω—ã—Ö –∂–∏—Ä–æ–≤',
            '–û—Ä–µ—Ö–∏ –∞—Å—Å–æ—Ä—Ç–∏ 30–≥ –¥–ª—è –∞–ª—å—Ñ–∞-–ª–∏–Ω–æ–ª–µ–Ω–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç—ã',
            '–¢–µ–º–Ω—ã–π —à–æ–∫–æ–ª–∞–¥ 85% –∫–∞–∫–∞–æ 20–≥ –¥–ª—è —Ñ–ª–∞–≤–æ–Ω–æ–∏–¥–æ–≤',
            '–°–≤–µ–∫–æ–ª—å–Ω—ã–π —Å–æ–∫ 250–º–ª –¥–ª—è –Ω–∏—Ç—Ä–∞—Ç–æ–≤'
          ],
          duration: '12 –Ω–µ–¥–µ–ª—å –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è —Ä–∏—Å–∫–∞',
          frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
          dosage: '–æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ: 30–º–ª/–¥–µ–Ω—å'
        },
        scientificBasis: '–ú–µ—Ç–∞-–∞–Ω–∞–ª–∏–∑ 2024–≥: —Å—Ä–µ–¥–∏–∑–µ–º–Ω–æ–º–æ—Ä—Å–∫–∞—è –¥–∏–µ—Ç–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –°–°–ó –Ω–∞ 30%',
        biohackingLevel: 'beginner'
      });

      recommendations.push({
        id: 'cardiovascular-supplements',
        title: '–ö–∞—Ä–¥–∏–æ–ø—Ä–æ—Ç–µ–∫—Ç–∏–≤–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏',
        description: '–î–æ–∫–∞–∑–∞–Ω–Ω—ã–µ –¥–æ–±–∞–≤–∫–∏ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã',
        category: 'supplements',
        priority: 'medium',
        evidenceLevel: 'rct',
        safetyWarnings: ['–ö–æ–Ω—Ç—Ä–æ–ª—å –ú–ù–û –ø—Ä–∏ –ø—Ä–∏–µ–º–µ –∞–Ω—Ç–∏–∫–æ–∞–≥—É–ª—è–Ω—Ç–æ–≤'],
        contraindications: ['–ê–ª–ª–µ—Ä–≥–∏—è –Ω–∞ —Ä—ã–±—É', '–ü—Ä–∏–µ–º –≤–∞—Ä—Ñ–∞—Ä–∏–Ω–∞ –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤—Ä–∞—á–∞'],
        implementation: {
          steps: [
            '–û–º–µ–≥–∞-3 EPA/DHA: 2000–º–≥ –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ–≤–æ—Å–ø–∞–ª–∏—Ç–µ–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞',
            '–ö–æ—ç–Ω–∑–∏–º Q10: 100-200–º–≥ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–π',
            '–í–∏—Ç–∞–º–∏–Ω K2 MK-7: 100–º–∫–≥ –¥–ª—è –∫–∞–ª—å—Ü–∏–µ–≤–æ–≥–æ –æ–±–º–µ–Ω–∞',
            '–ë–æ—è—Ä—ã—à–Ω–∏–∫: 300-600–º–≥ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Å–µ—Ä–¥—Ü–∞',
            '–ß–µ—Å–Ω–æ–∫ —ç–∫—Å—Ç—Ä–∞–∫—Ç: 600–º–≥ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –¥–∞–≤–ª–µ–Ω–∏—è'
          ],
          duration: '12-16 –Ω–µ–¥–µ–ª—å –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞',
          frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤–æ –≤—Ä–µ–º—è –µ–¥—ã',
          dosage: '–û–º–µ–≥–∞-3: 2000–º–≥, CoQ10: 100-200–º–≥'
        },
        scientificBasis: '–ö–æ—Ö—Ä–µ–π–Ω–æ–≤—Å–∫–∏–µ –æ–±–∑–æ—Ä—ã 2024–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–∞',
        biohackingLevel: 'intermediate'
      });

      recommendations.push({
        id: 'cardiovascular-tests',
        title: '–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã –∏ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è',
        description: '–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–≥–æ —Ä–∏—Å–∫–∞',
        category: 'supplements',
        priority: 'high',
        evidenceLevel: 'expert-opinion',
        safetyWarnings: ['–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞'],
        contraindications: ['–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'],
        implementation: {
          steps: [
            '–õ–∏–ø–∏–¥–æ–≥—Ä–∞–º–º–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è (–≤–∫–ª—é—á–∞—è –õ–ø(–∞))',
            'hsCRP - –º–∞—Ä–∫–µ—Ä –≤–æ—Å–ø–∞–ª–µ–Ω–∏—è —Å–æ—Å—É–¥–æ–≤',
            '–ì–æ–º–æ—Ü–∏—Å—Ç–µ–∏–Ω - —Å–æ—Å—É–¥–∏—Å—Ç—ã–π —Ä–∏—Å–∫-—Ñ–∞–∫—Ç–æ—Ä',
            'NT-proBNP - —Ñ—É–Ω–∫—Ü–∏—è —Å–µ—Ä–¥—Ü–∞',
            '–ö–æ—Ä–æ–Ω–∞—Ä–Ω—ã–π –∫–∞–ª—å—Ü–∏–π (–ö–¢) –ø–æ—Å–ª–µ 45 –ª–µ—Ç'
          ],
          duration: '–∫–∞–∂–¥—ã–µ 6-12 –º–µ—Å—è—Ü–µ–≤',
          frequency: '–ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞',
          dosage: '—Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è'
        },
        scientificBasis: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ESC/EAS 2024–≥ –ø–æ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ –°–°–ó',
        biohackingLevel: 'advanced'
      });
    }

    // –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö
    recommendations.push({
      id: 'metabolic-health',
      title: '–ú–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
      description: '–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ª—É—á—à–µ–Ω–∏—é —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–µ—Ç–∞–±–æ–ª–∏–∑–º–∞',
      category: 'nutrition',
      priority: score < 70 ? 'high' : 'medium',
      evidenceLevel: 'meta-analysis',
      safetyWarnings: [
        '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —ç–Ω–¥–æ–∫—Ä–∏–Ω–æ–ª–æ–≥–∞ –ø—Ä–∏ –¥–∏–∞–±–µ—Ç–µ',
        '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≥–ª—é–∫–æ–∑—ã –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∏—Ç–∞–Ω–∏—è',
        '–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ –≥–æ–ª–æ–¥–∞–Ω–∏—è'
      ],
      contraindications: [
        '–°–∞—Ö–∞—Ä–Ω—ã–π –¥–∏–∞–±–µ—Ç 1 —Ç–∏–ø–∞',
        '–†–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–∏—â–µ–≤–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è',
        '–ë–µ—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç—å –∏ –ª–∞–∫—Ç–∞—Ü–∏—è'
      ],
      implementation: {
        steps: [
          '–¶–∏—Ä–∫–∞–¥–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ: –ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–µ–º –¥–æ 19:00',
          '–•—Ä–æ–º –ø–∏–∫–æ–ª–∏–Ω–∞—Ç: 200–º–∫–≥ –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫ –∏–Ω—Å—É–ª–∏–Ω—É',
          '–ê–ª—å—Ñ–∞-–ª–∏–ø–æ–µ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞: 300–º–≥ –¥–ª—è –º–∏—Ç–æ—Ö–æ–Ω–¥—Ä–∏–π',
          '–ó–µ–ª–µ–Ω—ã–π —á–∞–π –º–∞—Ç—á–∞: 2-3 —á–∞—à–∫–∏ –¥–ª—è —Ç–µ—Ä–º–æ–≥–µ–Ω–µ–∑–∞',
          '–•–æ–ª–æ–¥–æ–≤–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è 10-15 –º–∏–Ω—É—Ç –¥–ª—è –±—É—Ä–æ–≥–æ –∂–∏—Ä–∞'
        ],
        duration: '4-6 –Ω–µ–¥–µ–ª—å –¥–ª—è –º–µ—Ç–∞–±–æ–ª–∏—á–µ—Å–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π',
        frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
        dosage: '–•—Ä–æ–º: 200–º–∫–≥, –ê–õ–ö: 300–º–≥'
      },
      scientificBasis: '–ú–µ—Ç–∞-–∞–Ω–∞–ª–∏–∑ 2024–≥: —Ü–∏—Ä–∫–∞–¥–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ + –¥–æ–±–∞–≤–∫–∏ —É–ª—É—á—à–∞—é—Ç –∏–Ω—Å—É–ª–∏–Ω–æ—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –Ω–∞ 40%',
      biohackingLevel: 'beginner'
    });

    recommendations.push({
      id: 'sleep-optimization',
      title: '–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–Ω–∞ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è',
      description: '–ù–∞—É—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Å–Ω–∞ –∏ —Ü–∏—Ä–∫–∞–¥–Ω—ã—Ö —Ä–∏—Ç–º–æ–≤',
      category: 'sleep',
      priority: 'high',
      evidenceLevel: 'rct',
      safetyWarnings: ['–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ–º–Ω–æ–ª–æ–≥–∞ –ø—Ä–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö —Å–Ω–∞'],
      contraindications: ['–¢—è–∂–µ–ª—ã–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å–Ω–∞'],
      implementation: {
        steps: [
          '–ú–∞–≥–Ω–∏–π –≥–ª–∏—Ü–∏–Ω–∞—Ç: 400–º–≥ –∑–∞ —á–∞—Å –¥–æ —Å–Ω–∞',
          '–ú–µ–ª–∞—Ç–æ–Ω–∏–Ω: 0.5-3–º–≥ –∑–∞ 30 –º–∏–Ω—É—Ç –¥–æ —Å–Ω–∞',
          '–ì–ª–∏—Ü–∏–Ω: 3–≥ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –≥–ª—É–±–æ–∫–æ–≥–æ —Å–Ω–∞',
          '–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∏–Ω–µ–≥–æ —Å–≤–µ—Ç–∞ –ø–æ—Å–ª–µ 20:00',
          '–£—Ç—Ä–µ–Ω–Ω–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ 10000 –ª—é–∫—Å 20 –º–∏–Ω—É—Ç'
        ],
        duration: '4-6 –Ω–µ–¥–µ–ª—å –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ —Ä–∏—Ç–º–æ–≤',
        frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å—Ç—Ä–æ–≥–æ –ø–æ –≤—Ä–µ–º–µ–Ω–∏',
        dosage: '–ú–∞–≥–Ω–∏–π: 400–º–≥, –ú–µ–ª–∞—Ç–æ–Ω–∏–Ω: 0.5-3–º–≥'
      },
      scientificBasis: '–†–ö–ò 2024–≥: –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–Ω–∞ —É–ª—É—á—à–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ 35%',
      biohackingLevel: 'intermediate'
    });

    recommendations.push({
      id: 'stress-management',
      title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–µ—Å—Å–æ–º –∏ –∞–¥–∞–ø—Ç–æ–≥–µ–Ω—ã',
      description: '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å—Ç—Ä–µ—Å—Å-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç–∞ –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏',
      category: 'stress',
      priority: 'medium',
      evidenceLevel: 'rct',
      safetyWarnings: ['–û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ –∞—É—Ç–æ–∏–º–º—É–Ω–Ω—ã—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö'],
      contraindications: ['–ü—Ä–∏–µ–º –∏–º–º—É–Ω–æ—Å—É–ø—Ä–µ—Å—Å–æ—Ä–æ–≤'],
      implementation: {
        steps: [
          '–ê—à–≤–∞–≥–∞–Ω–¥—Ö–∞ KSM-66: 300-600–º–≥ –¥–ª—è –∫–æ—Ä—Ç–∏–∑–æ–ª–∞',
          '–†–æ–¥–∏–æ–ª–∞ —Ä–æ–∑–æ–≤–∞—è: 300-400–º–≥ —É—Ç—Ä–æ–º –¥–ª—è –∞–¥–∞–ø—Ç–∞—Ü–∏–∏',
          '–î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –í–∏–º –•–æ—Ñ–∞ 10 –º–∏–Ω—É—Ç',
          '–•–æ–ª–æ–¥–Ω–∞—è —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è –¥–ª—è –≥–æ—Ä–º–µ–∑–∏—Å–∞',
          'HRV –º–µ–¥–∏—Ç–∞—Ü–∏—è 15 –º–∏–Ω—É—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ'
        ],
        duration: '8-10 –Ω–µ–¥–µ–ª—å –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π',
        frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ —É—Ç—Ä–æ–º',
        dosage: '–ê—à–≤–∞–≥–∞–Ω–¥—Ö–∞: 300-600–º–≥, –†–æ–¥–∏–æ–ª–∞: 300-400–º–≥'
      },
      scientificBasis: '–†–ö–ò 2024–≥: –∞–¥–∞–ø—Ç–æ–≥–µ–Ω—ã + –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–Ω–∏–∂–∞—é—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª –Ω–∞ 30%',
      biohackingLevel: 'intermediate'
    });

    recommendations.push({
      id: 'micronutrient-testing',
      title: '–ê–Ω–∞–ª–∏–∑ –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–æ–≤ –∏ –≤–∏—Ç–∞–º–∏–Ω–æ–≤',
      description: '–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –≤–∏—Ç–∞–º–∏–Ω–Ω–æ-–º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞',
      category: 'supplements',
      priority: 'medium',
      evidenceLevel: 'expert-opinion',
      safetyWarnings: ['–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ —Å –≤—Ä–∞—á–æ–º'],
      contraindications: ['–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç'],
      implementation: {
        steps: [
          '–í–∏—Ç–∞–º–∏–Ω D 25(OH) - –æ—Å–Ω–æ–≤–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞',
          '–í–∏—Ç–∞–º–∏–Ω B12 –∏ —Ñ–æ–ª–∞—Ç—ã - –Ω–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞',
          '–§–µ—Ä—Ä–∏—Ç–∏–Ω –∏ –∂–µ–ª–µ–∑–æ - —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –º–µ—Ç–∞–±–æ–ª–∏–∑–º',
          '–¶–∏–Ω–∫ –∏ —Å–µ–ª–µ–Ω - –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–Ω–∞—è –∑–∞—â–∏—Ç–∞',
          '–ô–æ–¥ –≤ –º–æ—á–µ - —Ñ—É–Ω–∫—Ü–∏—è —â–∏—Ç–æ–≤–∏–¥–Ω–æ–π –∂–µ–ª–µ–∑—ã'
        ],
        duration: '–∫–∞–∂–¥—ã–µ 6 –º–µ—Å—è—Ü–µ–≤',
        frequency: '—Ä–∞–∑ –≤ –ø–æ–ª–≥–æ–¥–∞',
        dosage: '–ø–æ –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–º –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º'
      },
      scientificBasis: '–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ESPEN 2024–≥ –ø–æ –º–∏–∫—Ä–æ–Ω—É—Ç—Ä–∏–µ–Ω—Ç–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ',
      biohackingLevel: 'beginner'
    });

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –±–∞–ª–ª–∞ –∑–¥–æ—Ä–æ–≤—å—è
    if (score < 60) {
      recommendations.push({
        id: 'foundational-health',
        title: '–ë–∞–∑–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è',
        description: '–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∑–¥–æ—Ä–æ–≤—å—è',
        category: 'sleep',
        priority: 'critical',
        evidenceLevel: 'meta-analysis',
        safetyWarnings: [
          '–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π',
          '–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è',
          '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –≤—Ä–∞—á–∞ –ø—Ä–∏ —Ö—Ä–æ–Ω–∏—á–µ—Å–∫–∏—Ö –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è—Ö'
        ],
        contraindications: [
          '–û—Å—Ç—Ä—ã–µ –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏—è',
          '–ü—Å–∏—Ö–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ —Å—Ç–∞–¥–∏–∏ –æ–±–æ—Å—Ç—Ä–µ–Ω–∏—è'
        ],
        implementation: {
          steps: [
            '–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è —Å–Ω–∞: –ª–æ–∂–∏—Ç—å—Å—è –≤ 22:30-23:00',
            '–í–∏—Ç–∞–º–∏–Ω D3: 2000-4000 –ú–ï –¥–ª—è –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞',
            '–ü—Ä–æ–±–∏–æ—Ç–∏–∫–∏: 10-50 –º–ª—Ä–¥ –ö–û–ï –¥–ª—è –º–∏–∫—Ä–æ–±–∏–æ–º–∞',
            '–ü—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–æ–ª–Ω—Ü–µ 30 –º–∏–Ω—É—Ç –µ–∂–µ–¥–Ω–µ–≤–Ω–æ',
            '–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –Ω–∞ 4 –Ω–µ–¥–µ–ª–∏'
          ],
          duration: '4-6 –Ω–µ–¥–µ–ª—å –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–∑—ã',
          frequency: '–µ–∂–µ–¥–Ω–µ–≤–Ω–æ —Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–µ–∂–∏–º—É',
          dosage: '–í–∏—Ç–∞–º–∏–Ω D3: 2000-4000 –ú–ï'
        },
        scientificBasis: '–°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–±–∑–æ—Ä—ã 2023-2024–≥–≥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é –≤–∞–∂–Ω–æ—Å—Ç—å —Å–Ω–∞ –∏ –≤–∏—Ç–∞–º–∏–Ω–∞ D',
        biohackingLevel: 'beginner'
      });
    }

    return recommendations;
  };

  const generateRecommendations = async () => {
    setIsGenerating(true);
    setLastAttempt(new Date());
    
    try {
      console.log('üîÑ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
      if (!navigator.onLine) {
        console.log('üì¥ –ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏');
        const fallbackRecommendations = generateGoalsBasedRecommendations(analytics, healthProfile?.healthGoals);
        setRecommendations(fallbackRecommendations);
        toast.warning('–ù–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É. –ü–æ–∫–∞–∑–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.');
        return;
      }

      // –§–æ—Ä–º–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Ü–µ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const requestData = {
        analytics: {
          ...analytics,
          healthScore: analytics.healthScore || 65,
          riskLevel: analytics.riskLevel || '—Å—Ä–µ–¥–Ω–∏–π',
          recommendations: analytics.recommendations || [],
          strengths: analytics.strengths || [],
          concerns: analytics.concerns || []
        },
        healthProfile: healthProfile || null,
        userGoals: healthProfile?.healthGoals || [],
        focusOnGoals: true
      };

      console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ —Å —Ü–µ–ª—è–º–∏:', healthProfile?.healthGoals);

      // –¢–∞–π–º–∞—É—Ç –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏
      const timeoutPromise = new Promise((_, reject) => {
        setTimeout(() => reject(new Error('–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞')), 15000);
      });

      const requestPromise = supabase.functions.invoke('generate-analytics-recommendations', {
        body: requestData
      });

      const { data, error } = await Promise.race([requestPromise, timeoutPromise]) as any;

      if (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ —Ñ—É–Ω–∫—Ü–∏–∏ Supabase:', error);
        throw new Error(`–§—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞: ${error.message}`);
      }

      if (data?.recommendations && Array.isArray(data.recommendations)) {
        console.log('‚úÖ –ü–æ–ª—É—á–µ–Ω—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç –ò–ò:', data.recommendations.length);
        setRecommendations(data.recommendations);
        toast.success(`–ü–æ–ª—É—á–µ–Ω—ã ${data.recommendations.length} –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –æ—Ç –ò–ò-–¥–æ–∫—Ç–æ—Ä–∞!`);
      } else {
        console.log('‚ö†Ô∏è –ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç –ò–ò, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏');
        throw new Error('–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
      }
    } catch (error) {
      console.error('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π:', error);
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
      const fallbackRecommendations = generateGoalsBasedRecommendations(analytics, healthProfile?.healthGoals);
      setRecommendations(fallbackRecommendations);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—à–∏–±–∫–∏
      if (error instanceof Error && error.message.includes('–¢–∞–π–º–∞—É—Ç')) {
        toast.error('–°–µ—Ä–≤–µ—Ä –ò–ò –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü–æ–∫–∞–∑–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.');
      } else if (!navigator.onLine) {
        toast.warning('–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º. –ü–æ–∫–∞–∑–∞–Ω—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.');
      } else {
        toast.info('–ò–ò-—Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–∫–∞–∑–∞–Ω—ã —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.');
      }
    } finally {
      setIsGenerating(false);
    }
  };

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  useEffect(() => {
    if (analytics && !recommendations.length && !isGenerating) {
      console.log('üéØ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ü–µ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
      generateRecommendations();
    }
  }, [analytics, healthProfile?.healthGoals]);

  return {
    recommendations,
    isGenerating,
    lastAttempt,
    generateRecommendations
  };
};
