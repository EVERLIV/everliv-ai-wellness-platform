
-- Добавляем новые поля в таблицу health_profiles для хранения медицинских анализов
-- Обновляем структуру JSON для включения лабораторных данных

-- Поскольку мы используем JSONB поле profile_data, нам не нужно изменять структуру таблицы
-- Но добавим комментарий для документирования новой структуры данных

COMMENT ON COLUMN public.health_profiles.profile_data IS 'JSON содержит: базовую информацию, образ жизни, медицинскую историю, и теперь лабораторные анализы включая: гемоглобин, эритроциты, гематокрит, MCV, MCHC, тромбоциты, холестерин, сахар крови, ЛДГ, сывороточное железо';

-- Добавляем индекс для быстрого поиска по лабораторным данным
CREATE INDEX IF NOT EXISTS idx_health_profiles_lab_data ON public.health_profiles USING GIN ((profile_data->'labResults'));
